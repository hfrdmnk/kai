(function(){let e=e=>{if(e===document.body)return`body`;if(e===document.documentElement)return`html`;if(e.id)return`#${e.id}`;let t=[],n=e;for(;n&&n!==document.body&&t.length<4;){let e=n.tagName.toLowerCase();if(n.id){t.unshift(`#${n.id}`);break}let r=Array.from(n.classList).filter(e=>!e.startsWith(`kai-`)).slice(0,2);r.length&&(e+=`.${r.join(`.`)}`);let i=[...t];i.unshift(e);let a=i.join(` > `);if(document.querySelectorAll(a).length===1)return a;let o=n.parentElement;if(o){let t=Array.from(o.children).filter(e=>e.tagName===n.tagName);if(t.length>1){let r=t.indexOf(n)+1;e+=`:nth-of-type(${r})`}}t.unshift(e),n=n.parentElement}return t.join(` > `)},t=e=>{if(e===document.documentElement)return`html`;if(e===document.body)return`html › body`;let t=[],n=e;for(;n&&n!==document.documentElement;){let e=n.tagName.toLowerCase(),r=Array.from(n.classList).filter(e=>!e.startsWith(`kai-`)).slice(0,2);r.length&&(e+=`.${r.join(`.`)}`),t.unshift(e),n=n.parentElement}return t.join(` › `)};var n=[`font-size`,`font-weight`,`font-family`,`line-height`,`color`,`background-color`,`padding-top`,`padding-right`,`padding-bottom`,`padding-left`,`margin-top`,`margin-right`,`margin-bottom`,`margin-left`,`border-radius`,`width`,`height`,`display`,`position`,`gap`];let r=e=>{let t=e.match(/^(\d+(?:\.\d+)?)px$/);if(!t)return null;let n=parseFloat(t[1])/16;return`${Math.round(n*1e3)/1e3}rem`},i=e=>{let t=window.getComputedStyle(e),i={};for(let e of n){let n=t.getPropertyValue(e);if(!n)continue;let a=r(n);i[e]=a?`${n} (${a})`:n}return i},a=e=>{let t=Array.from(e.childNodes).filter(e=>e.nodeType===Node.TEXT_NODE).map(e=>e.textContent?.trim()).filter(Boolean).join(` `).trim();return t?t.slice(0,40)+(t.length>40?`…`:``):``},o=e=>{let t=[],n=e.previousElementSibling;n&&t.push(n.textContent?.trim()??``),t.push(e.textContent?.trim()??``);let r=e.nextElementSibling;r&&t.push(r.textContent?.trim()??``);let i=t.filter(Boolean).join(` `).trim();return i.length>80?i.slice(0,80)+`…`:i};var s=()=>`ui-annotator:${location.origin}${location.pathname}`,c=`ui-annotator:fab-corner`;let l=()=>{try{let e=localStorage.getItem(s());return e?JSON.parse(e):[]}catch{return[]}},u=e=>{try{localStorage.setItem(s(),JSON.stringify(e))}catch{}},d=()=>{try{localStorage.removeItem(s())}catch{}},f=()=>{try{let e=localStorage.getItem(c);return e===`top-left`||e===`top-right`||e===`bottom-left`||e===`bottom-right`?e:`bottom-left`}catch{return`bottom-left`}},p=e=>{try{localStorage.setItem(c,e)}catch{}},m=(e,t,n)=>{let r=window.innerWidth,i=window.innerHeight,a=(r,i)=>{let a=document.elementFromPoint(r,i);return a?a===n?!0:a===document.elementFromPoint(e,t)||a===n:!1},o=(n,o)=>{let s=n===`x`?o===1?r-e:e:o===1?i-t:t;if(s<=0)return 0;let c=0,l=s,u=1;for(;u<s;){let s=n===`x`?e+o*u:e,d=n===`y`?t+o*u:t;if(s<0||s>=r||d<0||d>=i){l=u;break}if(!a(s,d)){l=u,c=u/2;break}u*=2}if(l===s&&a(n===`x`?e+o*(s-1):e,n===`y`?t+o*(s-1):t))return s;for(;l-c>1;){let r=Math.floor((c+l)/2);a(n===`x`?e+o*r:e,n===`y`?t+o*r:t)?c=r:l=r}return c},s=o(`x`,1),c=o(`x`,-1),l=o(`y`,1),u=o(`y`,-1);return{cx:e,cy:t,left:e-c,right:e+s,top:t-u,bottom:t+l,width:c+s,height:u+l}};var h=e=>{let t=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);if(!t)return e;let n=parseInt(t[1],10),r=parseInt(t[2],10),i=parseInt(t[3],10);return`#${(1<<24|n<<16|r<<8|i).toString(16).slice(1)}`};let g=e=>{if(!a(e))return null;let t=window.getComputedStyle(e),n=t.fontSize,i=r(n),o=t.lineHeight,s=r(o),c=t.letterSpacing,l=c===`normal`?null:r(c);return{fontFamily:t.fontFamily.split(`,`)[0].trim().replace(/['"]/g,``),fontSize:i?`${n} (${i})`:n,fontWeight:t.fontWeight,lineHeight:s?`${o} (${s})`:o,color:h(t.color),letterSpacing:l?`${c} (${l})`:c===`normal`?`normal`:c}},_=(e,t)=>{let n=new Set,r=new Map;for(let i=e.left+20/2;i<e.right;i+=20)for(let a=e.top+20/2;a<e.bottom;a+=20){let e=document.elementFromPoint(i,a);if(!e||e===t||e===document.documentElement||e===document.body)continue;r.set(e,(r.get(e)||0)+1);let o=e;for(;o&&o!==document.documentElement&&o!==document.body;)n.add(o),o=o.parentElement}let i=null,a=0;for(let r of n){if(r===t)continue;let n=r.getBoundingClientRect();if(n.left>=e.left&&n.top>=e.top&&n.right<=e.right&&n.bottom<=e.bottom){let e=n.width*n.height;e>a&&(a=e,i=r)}}if(i)return i;let o=null,s=0;for(let[e,t]of r)t>s&&(s=t,o=e);return o};var v=e=>`${e.element??`element`}${e.classes?.length?`.`+e.classes.join(`.`):``}`;let y=e=>{let t=e[0]?.url??location.href,n=[`# Page Feedback: ${(()=>{try{return new URL(t).pathname}catch{return t}})()}`,`**URL:** ${t}`,`**Viewport:** ${window.innerWidth}×${window.innerHeight}`,`**Exported:** ${new Date().toISOString()}`,``];return e.forEach((e,t)=>{n.push(`---`),n.push(``),n.push(`### ${t+1}. ${v(e)}`),n.push(``),n.push(`**Selector:** \`${e.selector}\``),n.push(`**Path:** ${e.path}`),e.classes?.length&&n.push(`**Classes:** ${e.classes.map(e=>"`."+e+"`").join(`, `)}`),n.push(`**Bounding box:** x:${Math.round(e.rect.x)}, y:${Math.round(e.rect.y)}, ${Math.round(e.rect.w)}×${Math.round(e.rect.h)}px`),e.nearbyText&&n.push(`**Nearby text:** "${e.nearbyText}"`),n.push(``);let r=Object.entries(e.styles);if(r.length){n.push(`**Computed CSS:**`),n.push("```css");for(let[e,t]of r)n.push(`${e}: ${t};`);n.push("```"),n.push(``)}let i=Object.entries(e.ariaAttributes??{});i.length&&n.push(`**Accessibility:** ${i.map(([e,t])=>`${e}="${t}"`).join(`, `)}`);let a=Object.entries(e.dataAttributes??{});a.length&&n.push(`**Data attributes:** ${a.map(([e,t])=>`${e}="${t}"`).join(`, `)}`),(i.length||a.length)&&n.push(``),e.comment&&(n.push(`**Annotation:** ${e.comment}`),n.push(``))}),n.join(`
`)},b=e=>{let t=document.createElement(`div`);t.className=`kai-overlay`,t.setAttribute(`aria-hidden`,`true`),t.style.display=`none`;let n=document.createElement(`div`);n.className=`kai-tooltip`,n.setAttribute(`aria-hidden`,`true`),n.style.display=`none`,e.appendChild(t),e.appendChild(n);let r=e=>{let t=e.tagName.toLowerCase();e.id&&(t+=`#${e.id}`);let n=Array.from(e.classList).filter(e=>!e.startsWith(`kai-`)).slice(0,3);n.length&&(t+=`.${n.join(`.`)}`);let r=a(e);return r&&(t+=`: "${r}"`),t};return{show:e=>{let i=e.getBoundingClientRect();t.style.display=`block`,t.style.top=`${i.top-4}px`,t.style.left=`${i.left-4}px`,t.style.width=`${i.width+8}px`,t.style.height=`${i.height+8}px`,n.textContent=r(e),n.style.display=`block`;let a=n.offsetWidth,o=n.offsetHeight,s=document.documentElement.clientWidth,c=document.documentElement.clientHeight,l=Math.max(4,Math.min(i.left,s-a-4)),u;u=i.top>o+4+2?i.top-o-2:i.bottom+o+6<c-4?i.bottom+6:4,n.style.left=`${l}px`,n.style.top=`${u}px`},hide:()=>{t.style.display=`none`,n.style.display=`none`},destroy:()=>{t.remove(),n.remove()}}};var x=`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M12 4V20M18 6L6.00001 18M20 12L4 12M18 18L6.00001 6.00001" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
</svg>
`,S=`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M9 3H15M3 6H21M10 16V11M14 16V11M5 6H19L18.1245 19.133C18.0544 20.1836 17.1818 21 16.1289 21L7.8461 21C6.79171 21 5.91842 20.1814 5.85028 19.1292L5 6Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
</svg>
`,C=`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M5 15H4C2.89543 15 2 14.1046 2 13V4C2 2.89543 2.89543 2 4 2H13C14.1046 2 15 2.89543 15 4V5M11 22H20C21.1046 22 22 21.1046 22 20V11C22 9.89543 21.1046 9 20 9H11C9.89543 9 9 9.89543 9 11V20C9 21.1046 9.89543 22 11 22Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
</svg>
`,w=`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M3 12L9 18L21 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
</svg>
`,T=`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M12 20.9642V21V20.5M12 15.465C15 13.9985 18 12.1054 18 8.86587C18 5.62624 15.3137 3 12 3C8.68629 3 6 5.62624 6 8.86587" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`;let E=`linear(0, 0.008 1.1%, 0.034 2.3%, 0.134 4.9%, 0.264 7.3%, 0.683 14.3%, 0.797 16.5%, 0.89 18.6%, 0.967 20.7%, 1.027 22.8%, 1.073 25%, 1.104 27.3%, 1.123 30.6%, 1.119 34.3%, 1.018 49.5%, 0.988 58.6%, 0.985 65.2%, 1 84.5%, 1)`;var D=new DOMParser,O=(e,t)=>{let n=D.parseFromString(t,`image/svg+xml`);e.appendChild(document.importNode(n.documentElement,!0))},k=typeof CSS<`u`&&CSS.supports(`anchor-name: --a`),ee=(e,t)=>{let n=window.innerWidth/2,r=window.innerHeight/2,i=e>=n,a=t>=r;return a&&i?`bottom-right`:a&&!i?`bottom-left`:!a&&i?`top-right`:`top-left`},A=(e,t,n)=>{let r=t.getBoundingClientRect();n===`top-left`||n===`top-right`?(e.style.top=`${r.top}px`,e.style.bottom=`auto`):(e.style.top=`auto`,e.style.bottom=`${document.documentElement.clientHeight-r.bottom}px`),n===`bottom-right`||n===`top-right`?(e.style.left=`auto`,e.style.right=`${document.documentElement.clientWidth-r.left+8}px`,e.style.flexDirection=`row-reverse`,e.style.transformOrigin=`right center`):(e.style.left=`${r.right+8}px`,e.style.right=`auto`,e.style.flexDirection=`row`,e.style.transformOrigin=`left center`)},j={shrinkMs:120,expandMs:400,blurPx:4,scaleDown:.3},M=async(e,t,n=``)=>{let r=e.querySelector(`svg`);r&&await r.animate([{transform:`scale(1)`,filter:`blur(0)`},{transform:`scale(${j.scaleDown})`,filter:`blur(${j.blurPx}px)`}],{duration:j.shrinkMs,easing:`ease-in`,fill:`forwards`}).finished,e.replaceChildren(),O(e,t),e.style.background=n,e.style.color=n?`var(--white)`:``,e.style.borderColor=n;let i=e.querySelector(`svg`);i&&i.animate([{transform:`scale(${j.scaleDown})`,filter:`blur(${j.blurPx}px)`},{transform:`scale(1)`,filter:`blur(0)`}],{duration:j.expandMs,easing:E})},N=5,P=(e,t,n)=>Math.max(t,Math.min(n,e)),F=(e,t)=>{let n=P(e/window.innerWidth,0,1),r=P(t/window.innerHeight,0,1),i=n*(1-r),a=(1-n)*(1-r),o=(1-n)*r,s=n*r,c=e=>`${22-18*e*e}px`;return`${c(i)} ${c(a)} ${c(o)} ${c(s)}`};let I=(e,t)=>{let n=t.initialCorner,r=!1,i=null,a=!1,o=[],s=document.createElement(`button`);s.className=`kai-fab`,s.setAttribute(`data-corner`,n),s.setAttribute(`aria-label`,`Toggle UI annotator`),s.setAttribute(`aria-pressed`,`false`),s.setAttribute(`aria-expanded`,`false`),O(s,x);let c=document.createElement(`span`);c.className=`kai-fab-badge`,c.style.display=`none`,s.appendChild(c);let l=document.createElement(`div`);l.className=`kai-fab-actions`,l.style.display=`none`;let u=document.createElement(`button`);u.className=`kai-fab-action`,u.setAttribute(`aria-label`,`Copy as Markdown`),O(u,C);let d=document.createElement(`button`);d.className=`kai-fab-action`,d.setAttribute(`aria-label`,`Clear all`),O(d,S);let f=document.createElement(`div`);f.className=`kai-tooltip`,f.style.display=`none`,f.style.fontFamily=`var(--font-sans)`,e.appendChild(f);let p=(e,t)=>{f.textContent=t,f.style.display=``;let r=e.getBoundingClientRect(),i=n===`top-left`||n===`top-right`;f.style.left=`${r.left+r.width/2}px`,f.style.transform=`translateX(-50%)`,i?(f.style.top=`${r.bottom+6}px`,f.style.bottom=`auto`):(f.style.top=`auto`,f.style.bottom=`${document.documentElement.clientHeight-r.top+6}px`)},m=()=>{f.style.display=`none`};u.addEventListener(`mouseenter`,()=>p(u,`Copy as Markdown`)),u.addEventListener(`mouseleave`,m),d.addEventListener(`mouseenter`,()=>p(d,`Clear all`)),d.addEventListener(`mouseleave`,m),l.appendChild(u),l.appendChild(d),e.appendChild(s),e.appendChild(l);let h=!1,g=!1,_=0,v=0,y=0,b=0;k?(s.addEventListener(`pointerdown`,e=>{e.preventDefault(),g=!0,h=!1,_=e.clientX,v=e.clientY;let t=s.getBoundingClientRect();y=t.left,b=t.top,s.setPointerCapture(e.pointerId),i?.cancel(),i=s.animate([{transform:`scale(1)`},{transform:`scale(0.9)`}],{duration:120,easing:`ease-out`,fill:`forwards`})}),s.addEventListener(`pointermove`,e=>{if(!g)return;let t=e.clientX-_,o=e.clientY-v,u=Math.sqrt(t*t+o*o);if(!h&&u>N&&(h=!0,i?.cancel(),s.style.position=`fixed`,s.style.left=`${y}px`,s.style.top=`${b}px`,s.style.right=`auto`,s.style.bottom=`auto`,s.classList.add(`kai-fab--dragging`),c.style.display!==`none`&&!a&&(a=!0,c.animate([{scale:`1`},{scale:`0`}],{duration:200,easing:`ease-out`,fill:`forwards`}),s.classList.remove(`kai-fab--has-badge`)),s.style.borderRadius=F(y+22,b+22),r&&U()),h){let e=Math.max(0,Math.min(window.innerWidth-44,y+t)),i=Math.max(0,Math.min(window.innerHeight-44,b+o));s.style.left=`${e}px`,s.style.top=`${i}px`,s.style.borderRadius=F(e+22,i+22),r&&l.style.display!==`none`&&A(l,s,n)}}),s.addEventListener(`pointerup`,e=>{if(g)if(g=!1,s.classList.remove(`kai-fab--dragging`),h){h=!1;let o=ee(e.clientX,e.clientY),l=parseFloat(s.style.left),u=parseFloat(s.style.top),d=s.style.borderRadius;s.style.left=``,s.style.top=``,s.style.right=``,s.style.bottom=``,s.style.position=``,s.style.borderRadius=``,n=o,s.setAttribute(`data-corner`,n),t.onCornerChange(n);let f=c.style.display!==`none`;f&&s.classList.add(`kai-fab--has-badge`);let p=s.getBoundingClientRect(),m=getComputedStyle(s).borderRadius;f&&s.classList.remove(`kai-fab--has-badge`);let g=l-p.left,_=u-p.top;i?.cancel(),i=s.animate([{transform:`translate(${g}px, ${_}px) scale(0.95)`,borderRadius:d},{transform:`translate(0, 0) scale(1)`,borderRadius:m}],{duration:600,easing:E}),r&&i.finished.then(()=>H()).catch(()=>{}),setTimeout(()=>{a=!1,c.style.display!==`none`&&(s.classList.add(`kai-fab--has-badge`),c.animate([{scale:`0`},{scale:`1`}],{duration:400,easing:E,fill:`forwards`}))},200)}else t.onToggle(),i?.cancel(),i=s.animate([{transform:`scale(0.9)`},{transform:`scale(1)`}],{duration:600,easing:E})})):(s.addEventListener(`pointerdown`,()=>{i?.cancel(),i=s.animate([{transform:`scale(1)`},{transform:`scale(0.9)`}],{duration:120,easing:`ease-out`,fill:`forwards`})}),s.addEventListener(`pointerup`,()=>{i?.cancel(),i=s.animate([{transform:`scale(0.9)`},{transform:`scale(1)`}],{duration:600,easing:E})}),s.addEventListener(`click`,e=>{e.stopPropagation(),t.onToggle()}));let D=document.createElement(`span`);D.setAttribute(`aria-live`,`polite`),D.style.cssText=`position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;`,e.appendChild(D);let j=null,P=()=>{M(u,C),j=null},I=()=>{j&&clearTimeout(j),M(u,w,`var(--color-success)`),D.textContent=`Copied`,j=setTimeout(()=>{P(),D.textContent=``},2e3)};u.addEventListener(`click`,e=>{e.stopPropagation(),t.onCopyMarkdown()});let L=!1,R=null,z=()=>{L=!1,M(d,S),R=null};d.addEventListener(`click`,e=>{e.stopPropagation(),L?(R&&clearTimeout(R),z(),t.onClearAll()):(L=!0,M(d,T,`var(--color-danger)`),R=setTimeout(z,3e3))});let B=e=>{e>0?(c.textContent=String(e),c.style.display=`flex`,a||s.classList.add(`kai-fab--has-badge`)):(c.style.display=`none`,a=!1,s.classList.remove(`kai-fab--has-badge`))},V=()=>n===`bottom-right`||n===`top-right`,H=()=>{o.forEach(e=>e.cancel()),o=[],l.style.display=`flex`,requestAnimationFrame(()=>{A(l,s,n);let e=V()?`12px`:`-12px`;[u,d].forEach((t,n)=>{let r=t.animate([{transform:`translateX(${e}) scale(0.8)`,opacity:0},{transform:`translateX(0) scale(1)`,opacity:1}],{duration:400,easing:E,delay:n*50,fill:`both`});o.push(r)})})},U=()=>{m(),o.forEach(e=>e.cancel()),o=[];let e=V()?`8px`:`-8px`,t=[u,d].map((t,n)=>t.animate([{transform:`translateX(0) scale(1)`,opacity:1},{transform:`translateX(${e}) scale(0.8)`,opacity:0}],{duration:150,easing:`ease-in`,delay:n*30,fill:`forwards`}));o=t,Promise.all(t.map(e=>e.finished)).then(()=>{l.style.display=`none`,t.forEach(e=>e.cancel()),o=[]})};return{updateBadge:B,setActive:e=>{r=e,s.setAttribute(`aria-pressed`,String(e)),s.setAttribute(`aria-expanded`,String(e)),e?(s.classList.add(`kai-fab--active`),H()):(s.classList.remove(`kai-fab--active`),U())},updateActionStates:e=>{let t=e===0;u.disabled=t,d.disabled=t},confirmCopy:I,destroy:()=>{s.remove(),l.remove(),f.remove(),D.remove()}}};var L=e=>{if(/^(#|rgb|hsl|oklch|oklab|lch|lab|color\(|hwb)/.test(e))return!0;let t=document.createElement(`span`);return t.style.color=e,t.style.color!==``};let R=e=>{let t=new Set,n=[],r=getComputedStyle(e);for(let e of Array.from(document.styleSheets)){let i;try{i=e.cssRules}catch{continue}let a=e=>{for(let i of Array.from(e))if(i instanceof CSSStyleRule)for(let e=0;e<i.style.length;e++){let a=i.style[e];if(a.startsWith(`--`)&&!t.has(a)){t.add(a);let e=r.getPropertyValue(a).trim();e&&n.push({name:a,value:e,isColor:L(e)})}}else `cssRules`in i&&a(i.cssRules)};a(i)}return n.sort((e,t)=>e.name.localeCompare(t.name)),n},z=(e,t,n)=>{let i=null,a=[],o=-1,s=null,c=0,l=0,u=()=>{i?.remove(),i=null,a=[],o=-1,s=null,e.removeAttribute(`aria-activedescendant`),e.setAttribute(`aria-expanded`,`false`)},d=t=>{a[o]&&a[o].setAttribute(`aria-selected`,`false`),o=t,a[o]&&(a[o].setAttribute(`aria-selected`,`true`),a[o].scrollIntoView({block:`nearest`}),e.setAttribute(`aria-activedescendant`,a[o].id))},f=()=>{let t=a[o];if(!t)return;let n=t.dataset.value,r=e.value.slice(0,c),i=e.value.slice(l);e.value=r+n+i,e.selectionStart=e.selectionEnd=c+n.length,e.dispatchEvent(new Event(`input`,{bubbles:!0})),u()},p=()=>{if(!i)return;let t=e.getBoundingClientRect();i.style.top=`${t.bottom+4}px`,i.style.left=`${t.left}px`,i.style.width=`${t.width}px`},m=()=>(i||(i=document.createElement(`div`),i.className=`kai-autocomplete`,i.setAttribute(`role`,`listbox`),i.id=`kai-ac-list`,t.appendChild(i),e.setAttribute(`aria-expanded`,`true`),e.setAttribute(`aria-controls`,`kai-ac-list`)),i.textContent=``,i),h=e=>{let t=n();if(!t)return;let r=R(t),i=e?r.filter(t=>t.name.includes(e)):r;if(!i.length){u();return}let s=m();a=i.slice(0,30).map((e,t)=>{let n=document.createElement(`div`);if(n.className=`kai-autocomplete-item`,n.setAttribute(`role`,`option`),n.setAttribute(`aria-selected`,`false`),n.id=`kai-ac-${t}`,n.dataset.value=e.name,e.isColor){let t=document.createElement(`span`);t.className=`kai-autocomplete-swatch`,t.style.background=e.value,n.appendChild(t)}let r=document.createElement(`span`);r.className=`kai-autocomplete-item-name`,r.textContent=e.name,n.appendChild(r);let i=document.createElement(`span`);return i.className=`kai-autocomplete-item-value`,i.textContent=e.value,n.appendChild(i),n.addEventListener(`pointerdown`,e=>{e.preventDefault(),o=t,f()}),n});for(let e of a)s.appendChild(e);p(),d(0)},g=e=>{let t=r(e);if(!t){u();return}let n=m(),i=document.createElement(`div`);i.className=`kai-autocomplete-rem`,i.setAttribute(`role`,`option`),i.setAttribute(`aria-selected`,`false`),i.id=`kai-ac-0`,i.dataset.value=t,i.textContent=`→ ${t}`,i.addEventListener(`pointerdown`,e=>{e.preventDefault(),o=0,f()}),a=[i],n.appendChild(i),p(),d(0)},_=()=>{let t=e.selectionStart,n=e.value.slice(0,t),r=n.match(/(\d+(?:\.\d+)?px)$/);if(r){s=`rem`,c=t-r[1].length,l=t,g(r[1]);return}let i=n.match(/(--[\w-]*)$/);if(i){s=`vars`,c=t-i[1].length,l=t,h(i[1]);return}s&&u()},v=e=>{i&&(e.key===`ArrowDown`?(e.preventDefault(),d(Math.min(o+1,a.length-1))):e.key===`ArrowUp`?(e.preventDefault(),d(Math.max(o-1,0))):e.key===`Tab`||e.key===`Enter`?o>=0&&(e.preventDefault(),f()):e.key===`Escape`&&(e.preventDefault(),u()))};return e.addEventListener(`input`,_),e.addEventListener(`keydown`,v),e.addEventListener(`blur`,()=>setTimeout(u,150)),{destroy:()=>{e.removeEventListener(`input`,_),e.removeEventListener(`keydown`,v),u()}}};var B=320,V=12,H=(e,t,n)=>{let r=n??t,i=n?4:8,a=document.documentElement.clientHeight-r.bottom,o=r.top,s=document.documentElement.clientHeight,c=a>=200||a>=o,l=c?r.bottom+i:r.top-i;requestAnimationFrame(()=>{let t=e.getBoundingClientRect().height,n=c?l:r.top-t-i;e.style.top=`${Math.max(V,Math.min(n,s-t-V))}px`});let u=Math.max(V,Math.min(r.left,document.documentElement.clientWidth-B-V));e.style.top=`${l}px`,e.style.left=`${u}px`};let U=(e,t)=>{let n=t.existingComment!=null,r=document.createElement(`div`);r.className=`kai-popover`,r.setAttribute(`role`,`dialog`),r.setAttribute(`aria-label`,n?`Edit annotation`:`Annotate element`);let i=document.createElement(`div`);i.className=`kai-popover-body`;let o=document.createElement(`div`);o.className=`kai-popover-path`,t.path.split(` › `).forEach((e,t)=>{t>0&&(o.appendChild(document.createElement(`wbr`)),o.appendChild(document.createTextNode(` › `))),e.split(/(?=[.#])/).forEach((e,t)=>{t>0&&o.appendChild(document.createElement(`wbr`)),o.appendChild(document.createTextNode(e))})});let s=document.createElement(`div`);s.className=`kai-popover-desc`;let c=a(t.element);c?s.textContent=`"${c}"`:s.style.display=`none`;let l=document.createElement(`textarea`);l.className=`kai-popover-textarea`,l.placeholder=`What should change?`,l.setAttribute(`aria-label`,`Annotation comment`),n&&(l.value=t.existingComment),i.appendChild(l),i.appendChild(o),i.appendChild(s);let u=document.createElement(`div`);u.className=`kai-popover-footer`;let d=()=>{let e=l.value.trim();e&&t.onSubmit(e)};if(n&&t.onDelete){let e=document.createElement(`button`);e.className=`kai-btn kai-btn--secondary`,e.textContent=`Delete`;let n=!1,r=null,i=()=>{n=!1,e.textContent=`Delete`,e.style.background=``,e.style.color=``,e.style.borderColor=``,r=null};e.addEventListener(`click`,()=>{n?(r&&clearTimeout(r),t.onDelete()):(n=!0,e.textContent=`Sure?`,e.style.background=`var(--color-danger)`,e.style.color=`var(--white)`,e.style.borderColor=`var(--color-danger)`,r=setTimeout(i,3e3))});let a=document.createElement(`div`);a.style.flex=`1`;let o=document.createElement(`button`);o.className=`kai-btn kai-btn--secondary`,o.textContent=`Cancel`,o.addEventListener(`click`,t.onClose);let s=document.createElement(`button`);s.className=`kai-btn kai-btn--primary`,s.textContent=`Save`,s.addEventListener(`click`,d),u.appendChild(e),u.appendChild(a),u.appendChild(o),u.appendChild(s)}else{let e=document.createElement(`button`);e.className=`kai-btn kai-btn--secondary`,e.textContent=`Cancel`,e.addEventListener(`click`,t.onClose);let n=document.createElement(`button`);n.className=`kai-btn kai-btn--primary`,n.textContent=`Add`,n.addEventListener(`click`,d),u.appendChild(e),u.appendChild(n)}l.addEventListener(`keydown`,e=>{e.key===`Enter`&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),d())}),r.appendChild(i),r.appendChild(u),e.appendChild(r),H(r,t.element.getBoundingClientRect(),t.anchorRect);let f=n=>{n.target!==e.host&&t.onClose()};window.addEventListener(`scroll`,f,{capture:!0,passive:!0});let p=n=>{n.composedPath().includes(e.host)||t.onClose()};document.addEventListener(`pointerdown`,p,{capture:!0});let m=()=>t.onClose();window.addEventListener(`resize`,m);let h=e.activeElement??document.activeElement;requestAnimationFrame(()=>l.focus());let g=z(l,e,()=>t.element);return r.addEventListener(`keydown`,n=>{n.key===`Escape`&&!e.querySelector(`.kai-autocomplete`)&&t.onClose()}),{destroy:()=>{window.removeEventListener(`scroll`,f,{capture:!0}),document.removeEventListener(`pointerdown`,p,{capture:!0}),window.removeEventListener(`resize`,m),g.destroy(),r.remove(),h instanceof HTMLElement&&h.focus()}}};var te=new DOMParser,W=22,G=4,K=8,q=9,J=(e,t)=>({top:Math.max(G+q,Math.min(e,document.documentElement.clientHeight-W-G)),left:Math.max(G,Math.min(t,document.documentElement.clientWidth-W-q-G))}),Y=()=>{let e=te.parseFromString(x,`image/svg+xml`),t=document.importNode(e.documentElement,!0);return t.setAttribute(`width`,`12`),t.setAttribute(`height`,`12`),t.setAttribute(`stroke-width`,`2.5`),t},ne=e=>{if(e.length===0)return[];let t=Array(e.length).fill(!1),n=[];for(let r=0;r<e.length;r++){if(t[r])continue;let i=[],a=[r];for(t[r]=!0;a.length>0;){let n=a.shift();i.push(e[n]);for(let r=0;r<e.length;r++){if(t[r])continue;let i=e[n].left-e[r].left,o=e[n].top-e[r].top;Math.sqrt(i*i+o*o)<W+q&&(t[r]=!0,a.push(r))}}n.push(i)}return n};let re=(e,t,n,r)=>{let i=new Map,a=new Map,o=new Set,s=[],c=0,l=null,u=null,d=null,f=!1,p=new Map,m=new Map,h=null,g=null,_=null,v=null,y=[],b=null,x=null,S=(e=!1)=>{if(v!==null&&(cancelAnimationFrame(v),v=null),_?.(),_=null,!h)return;let t=g;if(g=null,e){let e=h;h=null;let n=Array.from(e.querySelectorAll(`.kai-stack-expanded-marker`));y.forEach(e=>e.cancel()),y=[];let r=e.style.flexDirection===`row-reverse`?`8px`:`-8px`,i=n.map((e,t)=>e.animate([{transform:`translateX(0) scale(1)`,opacity:1},{transform:`translateX(${r}) scale(0.8)`,opacity:0}],{duration:150,easing:`ease-in`,delay:t*30,fill:`forwards`}));y=i;let a=e.querySelector(`.kai-tooltip`);a&&(a.style.display=`none`),Promise.all(i.map(e=>e.finished)).then(()=>{if(e.remove(),i.forEach(e=>e.cancel()),y=[],t){let e=t.querySelector(`.kai-marker-stack-badge`);e&&(x?.cancel(),x=e.animate([{transform:`translate(50%, -50%) scale(0)`},{transform:`translate(50%, -50%) scale(1)`}],{duration:400,easing:E,fill:`forwards`})),t.classList.add(`kai-marker-stack--has-badge`),b?.cancel(),b=t.animate([{opacity:.4},{opacity:1}],{duration:400,easing:E,fill:`forwards`})}}).catch(()=>{e.remove()})}else y.forEach(e=>e.cancel()),y=[],x?.cancel(),x=null,b?.cancel(),b=null,t&&t.classList.add(`kai-marker-stack--has-badge`),h.remove(),h=null},C=(i,a)=>{S();let o=document.createElement(`div`);o.className=`kai-stack-expanded`;let s=document.createElement(`div`);s.className=`kai-tooltip`,s.style.display=`none`,s.style.fontFamily=`var(--font-sans)`;let c=i.getBoundingClientRect(),l=document.documentElement.clientWidth,u=l-c.right>=c.left;o.style.flexDirection=u?`row`:`row-reverse`,u?o.style.left=`${c.right+6}px`:o.style.right=`${l-c.left+6}px`,o.style.top=`${c.top}px`;let d=[];for(let e of a){let a=document.createElement(`button`);a.className=`kai-stack-expanded-marker`;let c=Y();a.appendChild(c),a.addEventListener(`click`,n=>{n.stopPropagation(),S(!0),t(e,i.getBoundingClientRect())}),a.addEventListener(`mouseenter`,()=>{n?.(e.id),s.textContent=e.comment.trim()||e.path||e.selector,s.style.display=``;let t=a.getBoundingClientRect();s.style.left=`${t.left+t.width/2}px`,s.style.transform=`translateX(-50%)`,s.style.top=`${t.bottom+6}px`,s.style.bottom=`auto`}),a.addEventListener(`mouseleave`,()=>{r?.(e.id),s.style.display=`none`}),o.appendChild(a),d.push(a)}o.appendChild(s),e.appendChild(o),h=o,g=i;let f=i.querySelector(`.kai-marker-stack-badge`);f&&(x?.cancel(),x=f.animate([{transform:`translate(50%, -50%) scale(1)`},{transform:`translate(50%, -50%) scale(0)`}],{duration:200,easing:`ease-out`,fill:`forwards`})),i.classList.remove(`kai-marker-stack--has-badge`),b?.cancel(),b=i.animate([{opacity:1},{opacity:.4}],{duration:200,easing:`ease-out`,fill:`forwards`}),y.forEach(e=>e.cancel()),y=[],requestAnimationFrame(()=>{let e=u?`-12px`:`12px`;for(let t=0;t<d.length;t++){let n=d[t].animate([{transform:`translateX(${e}) scale(0.8)`,opacity:0},{transform:`translateX(0) scale(1)`,opacity:1}],{duration:400,easing:E,delay:t*50,fill:`both`});y.push(n)}});let p=e=>{if(!h)return;let t=e.target;!h.contains(t)&&t!==i&&!i.contains(t)&&S(!0)},m=t=>{h&&t.target!==e.host&&S(!0)},C=()=>{h&&S(!0)},w=e=>{e.key===`Escape`&&S(!0)};v=requestAnimationFrame(()=>{v=null,h&&(e.addEventListener(`click`,p,!0),document.addEventListener(`click`,m),window.addEventListener(`scroll`,C,!0),document.addEventListener(`keydown`,w))}),_=()=>{e.removeEventListener(`click`,p,!0),document.removeEventListener(`click`,m),window.removeEventListener(`scroll`,C,!0),document.removeEventListener(`keydown`,w)}},w=(i,a)=>{let o=p.get(i);if(o){let e=o.querySelector(`.kai-marker-stack-badge`);return e&&(e.textContent=String(a)),o}let c=document.createElement(`div`);c.className=f?`kai-marker-stack kai-marker-stack--has-badge`:`kai-marker-stack kai-marker-stack--has-badge kai-marker-stack--inactive`,c.appendChild(Y());let l=document.createElement(`span`);return l.className=`kai-marker-stack-badge`,l.textContent=String(a),c.appendChild(l),c.addEventListener(`click`,e=>{if(e.stopPropagation(),!f)return;if(g===c){S(!0);return}let n=(c.dataset.annotationIds?.split(`,`)||[]).map(e=>s.find(t=>t.id===e)).filter(e=>!!e);n.length===1?t(n[0],c.getBoundingClientRect()):n.length>1&&C(c,n)}),c.addEventListener(`mouseenter`,()=>{let e=c.dataset.annotationIds?.split(`,`)||[];for(let t of e)n?.(t)}),c.addEventListener(`mouseleave`,()=>{let e=c.dataset.annotationIds?.split(`,`)||[];for(let t of e)r?.(t)}),e.appendChild(c),p.set(i,c),c},T=()=>{let e=[];for(let t of s){let n=i.get(t.id);if(!n)continue;let r=document.querySelector(t.selector);if(!r){n.style.display=`none`;let e=a.get(t.id);e&&(e.style.display=`none`);continue}let s=r.getBoundingClientRect(),c=J(s.top-K,s.right-K);e.push({annotation:t,marker:n,top:c.top,left:c.left});let l=a.get(t.id);l&&(o.has(t.id)?(l.style.display=`block`,l.style.top=`${s.top-4}px`,l.style.left=`${s.left-4}px`,l.style.width=`${s.width+8}px`,l.style.height=`${s.height+8}px`):l.style.display=`none`)}let t=ne(e),n=new Set;m.clear();for(let e of t)if(e.length===1){let{marker:t,top:n,left:r}=e[0];t.style.display=`flex`,t.style.top=`${n}px`,t.style.left=`${r}px`}else{let t=e.map(e=>e.annotation.id).sort().join(`,`);n.add(t);let r=0,i=0;for(let n of e)r+=n.top,i+=n.left,n.marker.style.display=`none`,m.set(n.annotation.id,t);r/=e.length,i/=e.length;let a=J(r,i),o=w(t,e.length);o.dataset.annotationIds=t,o.style.top=`${a.top}px`,o.style.left=`${a.left}px`}for(let[e,t]of p)n.has(e)||(t===g&&S(!1),t.remove(),p.delete(e));if(d&&l&&u){let e=d.getBoundingClientRect(),t=J(e.top-K,e.right-K);l.style.top=`${t.top}px`,l.style.left=`${t.left}px`,u.style.top=`${e.top-4}px`,u.style.left=`${e.left-4}px`,u.style.width=`${e.width+8}px`,u.style.height=`${e.height+8}px`}c=requestAnimationFrame(T)},D=o=>{s=o;let c=new Set(o.map(e=>e.id));for(let[e,t]of i)c.has(e)||(t.remove(),i.delete(e));for(let[e,t]of a)c.has(e)||(t.remove(),a.delete(e));o.forEach(o=>{let s=i.get(o.id);s||(s=document.createElement(`div`),s.className=f?`kai-marker`:`kai-marker kai-marker--inactive`,s.setAttribute(`role`,`button`),s.setAttribute(`tabindex`,`0`),s.addEventListener(`click`,e=>{e.stopPropagation();let n=e.currentTarget;t(o,n.getBoundingClientRect())}),s.addEventListener(`mouseenter`,()=>n?.(o.id)),s.addEventListener(`mouseleave`,()=>r?.(o.id)),e.appendChild(s),i.set(o.id,s)),s.querySelector(`svg`)||s.appendChild(Y()),s.setAttribute(`aria-label`,`Annotation: ${o.comment.slice(0,50)}`);let c=a.get(o.id);c||(c=document.createElement(`div`),c.className=`kai-annotation-box`,e.appendChild(c),a.set(o.id,c))})},O=()=>{l?.remove(),u?.remove(),l=null,u=null,d=null};return c=requestAnimationFrame(T),{update:D,showPreview:t=>{O();let n=t.getBoundingClientRect(),r=document.createElement(`div`);r.className=`kai-annotation-box`,r.style.top=`${n.top-4}px`,r.style.left=`${n.left-4}px`,r.style.width=`${n.width+8}px`,r.style.height=`${n.height+8}px`,e.appendChild(r);let i=document.createElement(`div`);i.className=`kai-marker`,i.appendChild(Y()),i.style.pointerEvents=`none`;let a=J(n.top-K,n.right-K);return i.style.top=`${a.top}px`,i.style.left=`${a.left}px`,e.appendChild(i),l=i,u=r,d=t,new DOMRect(a.left,a.top,W,W)},clearPreview:O,showBox:e=>{o.add(e)},hideBox:e=>{o.delete(e)},setActive:e=>{f=e;for(let t of i.values())t.classList.toggle(`kai-marker--inactive`,!e);for(let t of p.values())t.classList.toggle(`kai-marker-stack--inactive`,!e);e||S()},destroy:()=>{cancelAnimationFrame(c),O(),S();for(let e of i.values())e.remove();i.clear();for(let e of a.values())e.remove();a.clear();for(let e of p.values())e.remove();p.clear(),m.clear()},getMarkerRect:e=>{let t=m.get(e);if(t){let e=p.get(t);if(e)return e.getBoundingClientRect()}return i.get(e)?.getBoundingClientRect()}}};var X=e=>{let t=document.createElement(`div`);return t.className=e,t.style.display=`none`,t};let ie=e=>{let t=X(`kai-measure-line kai-measure-line--v`),n=X(`kai-measure-line kai-measure-line--h`),r=X(`kai-measure-cross`),i=X(`kai-measure-tooltip`),a=X(`kai-measure-text-tooltip`),o=X(`kai-measure-selection`),s=X(`kai-measure-highlight`),c=[t,n,r,i,a,o,s];for(let t of c)e.appendChild(t);let l=()=>{for(let e of c)e.style.display=`none`};return{showCrosshair:e=>{let{cx:c,cy:l,left:u,right:d,top:f,bottom:p,width:m,height:h}=e,g=p-f;g>0?(t.style.display=`block`,t.style.left=`${c}px`,t.style.top=`${f}px`,t.style.height=`${g}px`):t.style.display=`none`;let _=d-u;_>0?(n.style.display=`block`,n.style.left=`${u}px`,n.style.top=`${l}px`,n.style.width=`${_}px`):n.style.display=`none`,r.style.display=`block`,r.style.left=`${c}px`,r.style.top=`${l}px`,i.textContent=`${Math.round(m)}×${Math.round(h)} px`,i.style.display=`block`;let v=window.innerWidth,y=window.innerHeight,b=c+12+100<v,x=l+12+24<y;i.style.left=b?`${c+12}px`:``,i.style.right=b?``:`${v-c+12}px`,i.style.top=x?`${l+12}px`:``,i.style.bottom=x?``:`${y-l+12}px`,a.style.display=`none`,o.style.display=`none`,s.style.display=`none`},showTextInfo:(e,t,n)=>{l(),a.textContent=``,[[`Font`,n.fontFamily],[`Size`,n.fontSize],[`Weight`,n.fontWeight],[`Line`,n.lineHeight],[`Color`,n.color],[`Track`,n.letterSpacing]].forEach(([e,t],n)=>{n>0&&a.appendChild(document.createTextNode(`
`));let r=document.createElement(`span`);r.className=`kai-tt-label`,r.textContent=e,a.appendChild(r),a.appendChild(document.createTextNode(t))}),a.style.display=`block`;let r=window.innerWidth,i=window.innerHeight,o=e+14+280<r,s=t+14+120<i;a.style.left=o?`${e+14}px`:``,a.style.right=o?``:`${r-e+14}px`,a.style.top=s?`${t+14}px`:``,a.style.bottom=s?``:`${i-t+14}px`},showSelection:(e,c,l,u)=>{let d=Math.min(e,l),f=Math.min(c,u),p=Math.abs(l-e),m=Math.abs(u-c);o.style.display=`block`,o.style.left=`${d}px`,o.style.top=`${f}px`,o.style.width=`${p}px`,o.style.height=`${m}px`,t.style.display=`none`,n.style.display=`none`,r.style.display=`none`,i.style.display=`none`,a.style.display=`none`,s.style.display=`none`},showHighlight:e=>{s.style.display=`block`,s.style.left=`${e.left}px`,s.style.top=`${e.top}px`,s.style.width=`${e.width}px`,s.style.height=`${e.height}px`,i.textContent=`${Math.round(e.width)}×${Math.round(e.height)} px`,i.style.display=`block`,i.style.left=`${e.left+e.width/2}px`,i.style.top=`${e.top+e.height/2}px`,i.style.right=``,i.style.bottom=``,i.className=`kai-measure-tooltip kai-measure-tooltip--centered`,t.style.display=`none`,n.style.display=`none`,r.style.display=`none`,a.style.display=`none`,o.style.display=`none`},hide:()=>{l(),i.className=`kai-measure-tooltip`},destroy:()=>{for(let e of c)e.remove()}}};var Z=/Mac|iPhone|iPad/.test(navigator.platform??navigator.userAgent),ae={alt:Z?`⌥`:`Alt`,shift:Z?`⇧`:`Shift`},oe={annotate:{text:`Click elements to annotate`,keys:[`alt`],hint:`inspect mode`},measure:{text:`Drag to measure`,keys:[`alt`,`shift`],hint:`text info`}},Q=(e,t=[])=>{let n=document.createDocumentFragment(),{text:r,keys:i,hint:a}=oe[e],o=document.createElement(`span`);o.textContent=r,n.appendChild(o);let s=document.createElement(`span`);s.className=`kai-guide-bar-sep`,s.textContent=`·`,n.appendChild(s);for(let e of i){let r=document.createElement(`span`);r.className=`kai-guide-bar-kbd`,r.setAttribute(`data-key`,e),t.includes(e)&&r.setAttribute(`data-pressed`,``),r.textContent=ae[e],n.appendChild(r)}let c=document.createElement(`span`);return c.className=`kai-guide-bar-hint`,c.textContent=a,n.appendChild(c),n};let se=e=>{let t=null,n=null,r=null,i=null,a=!1,o=document.createElement(`div`);o.className=`kai-guide-bar`,o.setAttribute(`aria-hidden`,`true`),o.style.display=`none`;let s=document.createElement(`div`);s.className=`kai-guide-bar-content`,o.appendChild(s),e.appendChild(o);let c=[],l=e=>{if(!a)return;c=e;let t=s.querySelectorAll(`.kai-guide-bar-kbd`);for(let n of t){let t=n.getAttribute(`data-key`);e.includes(t)?n.setAttribute(`data-pressed`,``):n.removeAttribute(`data-pressed`)}};return{show:(e,u=[])=>{if(c=u,a&&t===e){l(u);return}n?.cancel(),r?.cancel(),i?.cancel(),a?(t=e,r=s.animate([{opacity:1,transform:`translateY(0)`},{opacity:0,transform:`translateY(-4px)`}],{duration:150,easing:`ease-out`,fill:`forwards`}),r.finished.then(()=>{let t=o.getBoundingClientRect().width;s.replaceChildren(Q(e,c));let n=o.getBoundingClientRect().width;t!==n&&(i?.cancel(),i=o.animate([{width:`${t}px`},{width:`${n}px`}],{duration:250,easing:`linear(0, 0.012 0.9%, 0.05 2%, 0.411 9.2%, 0.517 11.8%, 0.611 14.6%, 0.694 17.7%, 0.765 21.1%, 0.824 24.8%, 0.872 28.9%, 0.91 33.4%, 0.939 38.4%, 0.977 50.9%, 0.994 68.4%, 1)`,fill:`forwards`}),i.finished.then(()=>{i?.cancel(),i=null}).catch(()=>{})),r=s.animate([{opacity:0,transform:`translateY(4px)`},{opacity:1,transform:`translateY(0)`}],{duration:200,easing:`ease-out`,fill:`forwards`})}).catch(()=>{})):(a=!0,t=e,o.style.display=``,s.replaceChildren(Q(e,c)),n=o.animate([{transform:`translateX(-50%) scale(0.8) translateY(-8px)`,opacity:0},{transform:`translateX(-50%) scale(1) translateY(0)`,opacity:1}],{duration:400,easing:E,fill:`forwards`}))},hide:()=>{a&&(a=!1,t=null,n?.cancel(),r?.cancel(),i?.cancel(),n=o.animate([{transform:`translateX(-50%) scale(1) translateY(0)`,opacity:1},{transform:`translateX(-50%) scale(0.9) translateY(-6px)`,opacity:0}],{duration:200,easing:`ease-out`,fill:`forwards`}),n.finished.then(()=>{a||(o.style.display=`none`)}).catch(()=>{}))},updateKeys:l,destroy:()=>{n?.cancel(),r?.cancel(),i?.cancel(),o.remove()}}};var ce=5,$=null,le=class extends HTMLElement{shadow;annotations=[];active=!1;fabCorner;altHeld=!1;shiftHeld=!1;dragging=!1;dragStart=null;lastMousePos={x:0,y:0};measureRafId=null;highlightLocked=!1;fab;overlay;inspector;markers;guideBar;activePopover=null;activePopoverAnnotationId=null;hoveredElement=null;handleMouseOver;handleMouseOut;handleClick;handleGlobalKeydown;handleKeydown;handleKeyup;handleWindowBlur;handleMouseMove;handleMouseDown;handleMouseUp;constructor(){if(super(),$){console.warn(`<ui-annotator> is a singleton — only one instance is allowed per page.`);return}$=this,this.shadow=this.attachShadow({mode:`closed`});let e=document.createElement(`style`);e.textContent=`
:host {
  --white: oklch(100% 0 0);
  --gray-50: oklch(98.5% 0.002 247.839);
  --gray-100: oklch(96.7% 0.003 264.542);
  --gray-200: oklch(92.8% 0.006 264.531);
  --gray-300: oklch(87.2% 0.01 258.338);
  --gray-400: oklch(70.7% 0.022 261.325);
  --gray-500: oklch(55.1% 0.027 264.364);
  --gray-600: oklch(44.6% 0.03 256.802);
  --gray-700: oklch(37.3% 0.034 259.733);
  --gray-800: oklch(27.8% 0.033 256.848);
  --gray-900: oklch(21% 0.034 264.665);
  --gray-950: oklch(13% 0.028 261.692);

  --color-accent: oklch(0.6927 0.2513 38.8022);
  --color-accent-hover: oklch(0.6405 0.2241 38.8022);
  --color-danger: oklch(0.6338 0.2516 24.17);
  --color-success: oklch(72.3% 0.219 149.579);

  --font-sans: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
  --font-mono: ui-monospace, SFMono-Regular, Menlo, monospace;

  --radius-sm: 0.25rem;
  --radius-md: 0.5rem;
  --radius-full: 9999px;

  --bg-1: var(--white);
  --bg-2: var(--gray-50);
  --bg-3: var(--gray-100);
  --bg-4: var(--gray-200);

  --border-1: var(--gray-50);
  --border-2: var(--gray-100);
  --border-3: var(--gray-200);
  --border-4: var(--gray-300);

  --text-primary: var(--gray-900);
  --text-secondary: var(--gray-600);
  --text-tertiary: var(--gray-500);

  --inv-bg: var(--gray-900);
  --inv-text: var(--white);
  --inv-text-muted: var(--gray-400);

  --z-overlay: 2147483643;
  --z-tooltip: 2147483647;
  --z-host: 2147483645;
  --z-fab: 2147483646;

  --shadow-2xs: 0 1px rgb(0 0 0 / 0.05);
  --shadow-xs: 0 1px 2px 0 rgb(0 0 0 / 0.05);
  --shadow-sm: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
  --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
  --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
  --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
  --shadow-2xl: 0 25px 50px -12px rgb(0 0 0 / 0.25);

  --inset-shadow-2xs: inset 0 1px rgb(0 0 0 / 0.05);
  --inset-shadow-xs: inset 0 1px 1px rgb(0 0 0 / 0.05);
  --inset-shadow-sm: inset 0 2px 4px rgb(0 0 0 / 0.05);

  --drop-shadow-xs: 0 1px 1px rgb(0 0 0 / 0.05);
  --drop-shadow-sm: 0 1px 2px rgb(0 0 0 / 0.15);
  --drop-shadow-md: 0 3px 3px rgb(0 0 0 / 0.12);
  --drop-shadow-lg: 0 4px 4px rgb(0 0 0 / 0.15);
  --drop-shadow-xl: 0 9px 7px rgb(0 0 0 / 0.1);
  --drop-shadow-2xl: 0 25px 25px rgb(0 0 0 / 0.15);

  position: fixed;
  width: 0;
  height: 0;
  overflow: visible;
  z-index: var(--z-host);
}

*, *::before, *::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

:focus-visible {
  outline: 2px solid var(--color-accent);
  outline-offset: 2px;
}

/* ── FAB ─────────────────────────────────────────── */

.kai-fab {
  position: fixed;
  width: 44px;
  height: 44px;
  border: 1px solid var(--border-1);
  background: var(--bg-1);
  color: var(--gray-700);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: var(--z-fab);
  pointer-events: auto;
  font-family: var(--font-sans);
  padding: 0;
  cursor: grab;
  user-select: none;
  transition: color 0.15s ease, background 0.15s ease;
  box-shadow: var(--shadow-sm);
}

.kai-fab:hover {
  color: var(--text-primary);
}

.kai-fab--active,
.kai-fab--active:hover {
  background: var(--color-accent);
  color: var(--white);
  border-color: var(--color-accent);
}

.kai-fab--active .kai-fab-badge {
  background: var(--white);
  color: var(--color-accent);
}

.kai-fab--dragging {
  cursor: grabbing;
}

.kai-fab svg {
  width: 24px;
  height: 24px;
}

.kai-fab[data-corner="bottom-right"] { bottom: 24px; right: 24px; border-radius: 22px 22px 22px 4px; }
.kai-fab[data-corner="bottom-left"] { bottom: 24px; left: 24px; border-radius: 22px 22px 4px 22px; }
.kai-fab[data-corner="top-right"] { top: 24px; right: 24px; border-radius: 4px 22px 22px 22px; }
.kai-fab[data-corner="top-left"] { top: 24px; left: 24px; border-radius: 22px 4px 22px 22px; }

.kai-fab-badge {
  position: absolute;
  min-width: 18px;
  height: 18px;
  background: var(--color-accent);
  color: var(--white);
  font-size: 12px;
  font-weight: 600;
  font-family: var(--font-sans);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0 4px;
  line-height: 1;
  border-radius: var(--radius-full);
}

/* Badge position per corner — diagonally opposite the pointy corner */
.kai-fab[data-corner="bottom-right"] .kai-fab-badge { top: -2px; right: -2px; transform: translate(50%, -50%); }
.kai-fab[data-corner="bottom-left"]  .kai-fab-badge { top: -2px; left: -2px; transform: translate(-50%, -50%); }
.kai-fab[data-corner="top-right"]    .kai-fab-badge { bottom: -2px; right: -2px; transform: translate(50%, 50%); }
.kai-fab[data-corner="top-left"]     .kai-fab-badge { bottom: -2px; left: -2px; transform: translate(-50%, 50%); }

/* Corner-shape scoop follows badge (diagonally opposite pointy corner) */
.kai-fab--has-badge[data-corner="bottom-right"] { corner-shape: round scoop round round; border-top-right-radius: 12px; }
.kai-fab--has-badge[data-corner="bottom-left"]  { corner-shape: scoop round round round; border-top-left-radius: 12px; }
.kai-fab--has-badge[data-corner="top-right"]    { corner-shape: round round scoop round; border-bottom-right-radius: 12px; }
.kai-fab--has-badge[data-corner="top-left"]     { corner-shape: round round round scoop; border-bottom-left-radius: 12px; }

/* ── FAB Actions ─────────────────────────────────── */

.kai-fab-actions {
  position: fixed;
  display: flex;
  gap: 4px;
  z-index: var(--z-fab);
  pointer-events: auto;
}

.kai-fab-action {
  width: 32px;
  height: 32px;
  border: 1px solid var(--border-2);
  background: var(--bg-2);
  color: var(--text-secondary);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  border-radius: var(--radius-full);
  padding: 4px;
  transition: background 0.15s ease, color 0.15s ease, border-color 0.15s ease;
  will-change: transform, opacity;
  box-shadow: var(--shadow-xs);
}

.kai-fab-action:hover {
  background: var(--bg-3);
  color: var(--text-primary);
}

.kai-fab-action:disabled {
  opacity: 0.35;
  cursor: default;
  pointer-events: none;
}

.kai-fab-action svg {
  width: 16px;
  height: 16px;
}

/* ── Overlay ─────────────────────────────────────── */

.kai-overlay {
  position: fixed;
  pointer-events: none;
  border: 1.5px dashed var(--color-accent);
  background: hsl(from var(--color-accent) h s l / 5%);
  border-radius: var(--radius-sm);
  z-index: var(--z-overlay);
  transition: all 0.08s ease;
}

/* ── Tooltip ─────────────────────────────────────── */

.kai-tooltip {
  position: fixed;
  pointer-events: none;
  background: var(--inv-bg);
  color: var(--inv-text);
  font-family: var(--font-mono);
  font-size: 12px;
  line-height: 1;
  padding: 4px 8px;
  border-radius: var(--radius-sm);
  white-space: nowrap;
  z-index: var(--z-tooltip);
  box-shadow: var(--shadow-sm);
}

/* ── Popover ─────────────────────────────────────── */

.kai-popover {
  position: fixed;
  width: 320px;
  background: var(--bg-1);
  color: var(--text-primary);
  border: 1px solid var(--border-2);
  box-shadow: var(--shadow-md);
  z-index: var(--z-tooltip);
  pointer-events: auto;
  font-family: var(--font-sans);
  border-radius: var(--radius-md);
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.kai-popover-body {
  padding: 16px;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.kai-popover-path {
  font-family: var(--font-mono);
  font-size: 12px;
  color: var(--text-tertiary);
  line-height: 1.5;
  word-break: normal;
  overflow-wrap: break-word;
}

.kai-popover-desc {
  font-size: 12px;
  color: var(--text-secondary);
}

.kai-popover-textarea {
  width: 100%;
  min-height: 72px;
  border: 1px solid var(--border-2);
  background: var(--bg-2);
  color: var(--gray-900);
  padding: 10px 12px;
  font-family: var(--font-sans);
  font-size: 13px;
  resize: vertical;
  line-height: 1.5;
  border-radius: var(--radius-sm);
  transition: border-color 0.15s ease;
}

.kai-popover-textarea:focus {
  outline: 2px solid var(--color-accent);
  outline-offset: -2px;
  border-color: var(--color-accent);
}

.kai-popover-textarea::placeholder {
  color: var(--gray-400);
}

.kai-popover-footer {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: 8px;
  padding: 0 16px 16px;
}

/* ── Buttons ─────────────────────────────────────── */

.kai-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  min-height: 36px;
  padding: 0 14px;
  border: none;
  border-radius: var(--radius-sm);
  font-family: var(--font-sans);
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  transition: background 0.15s ease;
  white-space: nowrap;
}

.kai-btn--primary {
  background: var(--color-accent);
  color: var(--white);
  font-weight: 600;
}

.kai-btn--primary:hover {
  background: var(--color-accent-hover);
}

.kai-btn--secondary {
  background: var(--bg-3);
  color: var(--text-tertiary);
  border: 1px solid var(--border-3);
  padding: 0 14px;
  min-height: 36px;
}

.kai-btn--secondary:hover {
  background: var(--bg-4);
  color: var(--text-primary);
}

.kai-btn--icon {
  width: 36px;
  height: 36px;
  min-height: 36px;
  padding: 0;
  border-radius: var(--radius-sm);
  background: transparent;
  color: var(--text-tertiary);
}

.kai-btn--icon:hover {
  background: var(--bg-3);
  color: var(--gray-700);
}

/* ── Markers ─────────────────────────────────────── */

.kai-marker,
.kai-marker-stack {
  position: fixed;
  width: 22px;
  height: 22px;
  background: var(--color-accent);
  color: var(--white);
  font-family: var(--font-sans);
  font-size: 12px;
  font-weight: 600;
  display: flex;
  align-items: center;
  justify-content: center;
  pointer-events: auto;
  cursor: pointer;
  z-index: var(--z-host);
  border: 1px solid var(--color-accent);
}

.kai-marker {
  border-radius: 9999px 9999px 9999px var(--radius-sm);
}

.kai-marker-stack {
  border-radius: 11px 11px 11px 0;
}

.kai-marker-stack--has-badge {
  corner-shape: round scoop round round;
  border-top-right-radius: 6px;
}

.kai-marker--inactive,
.kai-marker-stack--inactive {
  background: var(--bg-3);
  border: 1px solid var(--border-3);
  color: var(--text-tertiary);
  pointer-events: none;
  cursor: default;
}

.kai-marker-stack-badge {
  position: absolute;
  min-width: 14px;
  height: 14px;
  background: var(--white);
  color: var(--color-accent);
  font-size: 9px;
  font-weight: 700;
  font-family: var(--font-sans);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0 3px;
  line-height: 1;
  border-radius: var(--radius-full);
  top: -2px;
  right: -2px;
  transform: translate(50%, -50%);
}

.kai-marker-stack--inactive .kai-marker-stack-badge {
  background: var(--border-3);
  color: var(--text-tertiary);
}

.kai-stack-expanded {
  position: fixed;
  display: flex;
  gap: 6px;
  z-index: var(--z-tooltip);
  pointer-events: auto;
  align-items: center;
}

.kai-stack-expanded-marker {
  width: 22px;
  height: 22px;
  border-radius: 9999px 9999px 9999px var(--radius-sm);
  background: var(--color-accent);
  color: var(--white);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  border: none;
  will-change: transform, opacity;
  box-shadow: var(--shadow-xs);
}

.kai-stack-expanded-marker svg {
  width: 12px;
  height: 12px;
}

/* ── Annotation Boxes ───────────────────────────── */

.kai-annotation-box {
  position: fixed;
  pointer-events: none;
  border: 1.5px dashed var(--gray-300);
  background: rgb(0 0 0 / 0.02);
  z-index: var(--z-overlay);
  border-radius: var(--radius-sm);
}

/* ── Autocomplete ────────────────────────────────── */

.kai-autocomplete {
  position: fixed;
  background: var(--bg-3);
  border: 1px solid var(--border-3);
  border-radius: var(--radius-sm);
  max-height: 200px;
  overflow-y: auto;
  z-index: var(--z-tooltip);
  pointer-events: auto;
  font-family: var(--font-mono);
  font-size: 12px;
  min-width: 200px;
}

.kai-autocomplete-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 10px;
  cursor: pointer;
  transition: background 0.08s ease;
  color: var(--text-primary);
}

.kai-autocomplete-item:hover,
.kai-autocomplete-item[aria-selected="true"] {
  background: var(--bg-2);
}

.kai-autocomplete-item-name {
  flex: 1;
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  color: var(--gray-700);
}

.kai-autocomplete-item-value {
  color: var(--text-tertiary);
  font-size: 12px;
  max-width: 100px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.kai-autocomplete-swatch {
  width: 12px;
  height: 12px;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border-2);
  flex-shrink: 0;
}

.kai-autocomplete-rem {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 6px 10px;
  cursor: pointer;
  color: var(--text-secondary);
}

.kai-autocomplete-rem:hover,
.kai-autocomplete-rem[aria-selected="true"] {
  background: var(--bg-2);
}

/* ── Syntax highlighting ─────────────────────────── */

.kai-style-prop {
  color: var(--text-tertiary);
}

.kai-style-value {
  color: var(--gray-200);
}

/* ── Measurement tool (Alt-inspect mode) ─────────── */

.kai-measure-line {
  position: fixed;
  pointer-events: none;
  background: var(--color-accent);
  z-index: var(--z-tooltip);
}

.kai-measure-line--v {
  width: 1px;
}

.kai-measure-line--v::before,
.kai-measure-line--v::after {
  content: '';
  position: absolute;
  left: -3px;
  width: 7px;
  height: 1px;
  background: var(--color-accent);
}

.kai-measure-line--v::before { top: 0; }
.kai-measure-line--v::after { bottom: 0; }

.kai-measure-line--h {
  height: 1px;
}

.kai-measure-line--h::before,
.kai-measure-line--h::after {
  content: '';
  position: absolute;
  top: -3px;
  width: 1px;
  height: 7px;
  background: var(--color-accent);
}

.kai-measure-line--h::before { left: 0; }
.kai-measure-line--h::after { right: 0; }

.kai-measure-cross {
  position: fixed;
  pointer-events: none;
  width: 0;
  height: 0;
  z-index: var(--z-tooltip);
}

.kai-measure-cross::before,
.kai-measure-cross::after {
  content: '';
  position: absolute;
  background: var(--color-accent);
}

.kai-measure-cross::before {
  width: 11px;
  height: 1px;
  top: 0;
  left: -5px;
}

.kai-measure-cross::after {
  width: 1px;
  height: 11px;
  top: -5px;
  left: 0;
}

.kai-measure-tooltip {
  position: fixed;
  pointer-events: none;
  background: var(--inv-bg);
  color: var(--inv-text);
  font-family: var(--font-mono);
  font-size: 11px;
  line-height: 1;
  padding: 4px 8px;
  border-radius: var(--radius-full);
  white-space: nowrap;
  z-index: var(--z-tooltip);
}

.kai-measure-tooltip--centered {
  transform: translate(-50%, -50%);
}

.kai-measure-text-tooltip {
  position: fixed;
  pointer-events: none;
  background: var(--inv-bg);
  color: var(--inv-text);
  font-family: var(--font-mono);
  font-size: 11px;
  line-height: 1.6;
  padding: 8px 12px;
  border-radius: var(--radius-sm);
  white-space: pre;
  max-width: 280px;
  z-index: var(--z-tooltip);
}

.kai-measure-text-tooltip .kai-tt-label {
  display: inline-block;
  width: 6ch;
  text-align: right;
  margin-right: 2ch;
  color: var(--inv-text-muted);
}

.kai-measure-selection {
  position: fixed;
  pointer-events: none;
  border: 1.5px dashed var(--color-accent);
  background: hsl(from var(--color-accent) h s l / 5%);
  z-index: var(--z-overlay);
}

.kai-measure-highlight {
  position: fixed;
  pointer-events: none;
  border: 2px solid var(--color-accent);
  background: hsl(from var(--color-accent) h s l / 8%);
  border-radius: var(--radius-sm);
  z-index: var(--z-overlay);
}

/* ── Guide Bar ──────────────────────────────────── */

.kai-guide-bar {
  position: fixed;
  top: 16px;
  left: 50%;
  transform: translateX(-50%);
  display: inline-flex;
  align-items: center;
  background: var(--inv-bg);
  color: var(--inv-text);
  font-family: var(--font-sans);
  font-size: 13px;
  padding: 6px 14px;
  border-radius: var(--radius-full);
  box-shadow: var(--shadow-lg);
  z-index: var(--z-fab);
  pointer-events: none;
  white-space: nowrap;
}

.kai-guide-bar-content {
  display: flex;
  align-items: center;
  gap: 8px;
}

.kai-guide-bar-sep {
  color: var(--inv-text-muted);
}

.kai-guide-bar-kbd {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 20px;
  height: 20px;
  padding: 0 5px;
  background: var(--gray-700);
  border-radius: var(--radius-sm);
  font-size: 11px;
  font-weight: 700;
  line-height: 1;
  transition: background 0.15s ease;
}

.kai-guide-bar-kbd[data-pressed] {
  background: var(--color-accent);
}

.kai-guide-bar-hint {
  color: var(--inv-text-muted);
}
`,this.shadow.appendChild(e),this.annotations=l(),this.fabCorner=f(),this.fab=I(this.shadow,{initialCorner:this.fabCorner,onToggle:()=>this.toggle(),onCopyMarkdown:()=>{navigator.clipboard.writeText(y(this.annotations)).then(()=>{this.fab.confirmCopy()})},onClearAll:()=>{this.annotations=[],d(),this.markers.update([]),this.fab.updateBadge(0),this.fab.updateActionStates(0),this.closePopover()},onCornerChange:e=>{this.fabCorner=e,p(e)}}),this.overlay=b(this.shadow),this.inspector=ie(this.shadow),this.guideBar=se(this.shadow),this.markers=re(this.shadow,(e,t)=>{this.openEditPopover(e,t)},e=>this.markers.showBox(e),e=>{this.activePopoverAnnotationId!==e&&this.markers.hideBox(e)}),this.annotations.length&&(this.markers.update(this.annotations),this.fab.updateBadge(this.annotations.length)),this.fab.updateActionStates(this.annotations.length),this.handleMouseOver=e=>{if(this.isOwnElement(e))return;let t=e.target;this.hoveredElement=t,this.altHeld||this.overlay.show(t)},this.handleMouseOut=()=>{this.hoveredElement=null,this.altHeld||this.overlay.hide()},this.handleClick=e=>{if(this.isOwnElement(e)||(e.preventDefault(),e.stopImmediatePropagation(),this.altHeld))return;let t=this.hoveredElement;if(!t)return;this.overlay.hide();let n=this.annotations.find(e=>{try{return document.querySelector(e.selector)===t}catch{return!1}});if(n){let e=this.markers.getMarkerRect(n.id);this.openEditPopover(n,e)}else{let e=this.markers.showPreview(t);this.openPopover(t,e)}},this.handleGlobalKeydown=e=>{e.key===`A`&&e.ctrlKey&&e.shiftKey&&(e.preventDefault(),this.toggle()),e.key===`Escape`&&this.active&&!this.activePopover&&this.deactivate()},this.handleKeydown=e=>{if(e.key===`Alt`){if(this.altHeld)return;this.altHeld=!0,this.overlay.hide(),document.body.style.cursor=`crosshair`,this.guideBar.show(`measure`,[`alt`]),this.scheduleMeasureUpdate()}e.key===`Shift`&&(this.shiftHeld=!0,this.altHeld&&this.guideBar.updateKeys([`alt`,`shift`]),this.altHeld&&!this.dragging&&!this.highlightLocked&&this.scheduleMeasureUpdate())},this.handleKeyup=e=>{e.key===`Alt`&&this.exitMeasureMode(),e.key===`Shift`&&(this.shiftHeld=!1,this.altHeld&&this.guideBar.updateKeys([`alt`]),this.altHeld&&!this.dragging&&!this.highlightLocked&&this.scheduleMeasureUpdate())},this.handleWindowBlur=()=>{this.altHeld&&this.exitMeasureMode()},this.handleMouseMove=e=>{if(this.lastMousePos={x:e.clientX,y:e.clientY},this.altHeld){if(this.dragStart&&!this.dragging){let t=e.clientX-this.dragStart.x,n=e.clientY-this.dragStart.y;Math.sqrt(t*t+n*n)>=ce&&(this.dragging=!0,this.highlightLocked=!1)}this.scheduleMeasureUpdate()}},this.handleMouseDown=e=>{this.isOwnElement(e)||(e.preventDefault(),e.stopImmediatePropagation(),this.altHeld&&e.button===0&&(this.dragStart={x:e.clientX,y:e.clientY},this.dragging=!1,this.highlightLocked=!1))},this.handleMouseUp=e=>{if(!this.isOwnElement(e)&&(e.preventDefault(),e.stopImmediatePropagation(),this.altHeld&&e.button===0)){if(this.dragging&&this.dragStart){let t=this.dragStart.x,n=this.dragStart.y,r=e.clientX,i=e.clientY,a=_(new DOMRect(Math.min(t,r),Math.min(n,i),Math.abs(r-t),Math.abs(i-n)),this);a?(this.inspector.showHighlight(a.getBoundingClientRect()),this.highlightLocked=!0):this.inspector.hide()}this.dragStart=null,this.dragging=!1}}}exitMeasureMode(){this.altHeld=!1,this.shiftHeld=!1,this.dragging=!1,this.dragStart=null,this.highlightLocked=!1,document.body.style.cursor=``,this.inspector.hide(),this.active&&this.guideBar.show(`annotate`),this.measureRafId!==null&&(cancelAnimationFrame(this.measureRafId),this.measureRafId=null),this.hoveredElement&&this.overlay.show(this.hoveredElement)}scheduleMeasureUpdate(){this.measureRafId===null&&(this.measureRafId=requestAnimationFrame(()=>{this.measureRafId=null,this.updateMeasure()}))}updateMeasure(){if(!this.altHeld||this.highlightLocked)return;let{x:e,y:t}=this.lastMousePos;if(this.dragging&&this.dragStart){this.inspector.showSelection(this.dragStart.x,this.dragStart.y,e,t);return}if(this.shiftHeld){let n=document.elementFromPoint(e,t);if(n&&n!==this){let r=g(n);if(r){this.inspector.showTextInfo(e,t,r);return}}this.inspector.hide();return}let n=m(e,t,this);this.inspector.showCrosshair(n)}connectedCallback(){document.addEventListener(`keydown`,this.handleGlobalKeydown)}disconnectedCallback(){$===this&&($=null),this.deactivate(),document.removeEventListener(`keydown`,this.handleGlobalKeydown),this.markers.destroy(),this.overlay.destroy(),this.inspector.destroy(),this.guideBar.destroy(),this.fab.destroy()}toggle(){this.active?this.deactivate():this.activate()}activate(){this.active=!0,this.fab.setActive(!0),this.markers.setActive(!0),this.guideBar.show(`annotate`),document.addEventListener(`mouseover`,this.handleMouseOver,!0),document.addEventListener(`mouseout`,this.handleMouseOut,!0),document.addEventListener(`click`,this.handleClick,!0),document.addEventListener(`keydown`,this.handleKeydown),document.addEventListener(`keyup`,this.handleKeyup),document.addEventListener(`mousemove`,this.handleMouseMove,!0),document.addEventListener(`mousedown`,this.handleMouseDown,!0),document.addEventListener(`mouseup`,this.handleMouseUp,!0),window.addEventListener(`blur`,this.handleWindowBlur)}deactivate(){this.active=!1,this.fab.setActive(!1),this.markers.setActive(!1),this.guideBar.hide(),this.altHeld&&this.exitMeasureMode(),document.removeEventListener(`mouseover`,this.handleMouseOver,!0),document.removeEventListener(`mouseout`,this.handleMouseOut,!0),document.removeEventListener(`click`,this.handleClick,!0),document.removeEventListener(`keydown`,this.handleKeydown),document.removeEventListener(`keyup`,this.handleKeyup),document.removeEventListener(`mousemove`,this.handleMouseMove,!0),document.removeEventListener(`mousedown`,this.handleMouseDown,!0),document.removeEventListener(`mouseup`,this.handleMouseUp,!0),window.removeEventListener(`blur`,this.handleWindowBlur),this.overlay.hide(),this.inspector.hide(),this.hoveredElement=null,this.closePopover(),this.measureRafId!==null&&(cancelAnimationFrame(this.measureRafId),this.measureRafId=null)}isOwnElement(e){return e.composedPath().some(e=>e===this||e===this.shadow)}openPopover(n,r){this.closePopover();let a=e(n),s=t(n),c=i(n),l=n.getBoundingClientRect();this.activePopover=U(this.shadow,{element:n,selector:a,path:s,styles:c,anchorRect:r,onSubmit:e=>{let t={},r={};for(let e of Array.from(n.attributes))e.name===`role`||e.name.startsWith(`aria-`)?t[e.name]=e.value:e.name.startsWith(`data-`)&&(r[e.name]=e.value);let i={id:crypto.randomUUID(),selector:a,path:s,comment:e,styles:c,rect:{x:l.x,y:l.y,w:l.width,h:l.height},createdAt:new Date().toISOString(),element:n.tagName.toLowerCase(),classes:Array.from(n.classList).filter(e=>!e.startsWith(`kai-`)),nearbyText:o(n),url:location.href,ariaAttributes:t,dataAttributes:r};this.annotations.push(i),this.markers.clearPreview(),this.persist(),this.closePopover()},onClose:()=>{this.markers.clearPreview(),this.closePopover()}})}openEditPopover(e,t){this.closePopover(),this.activePopoverAnnotationId=e.id,this.markers.showBox(e.id);let n=document.querySelector(e.selector);if(!n)return;let r=e.path,a=i(n);this.activePopover=U(this.shadow,{element:n,selector:e.selector,path:r,styles:a,existingComment:e.comment,anchorRect:t,onSubmit:t=>{e.comment=t,this.persist(),this.closePopover()},onDelete:()=>{this.annotations=this.annotations.filter(t=>t.id!==e.id),this.persist(),this.closePopover()},onClose:()=>this.closePopover()})}closePopover(){this.activePopoverAnnotationId&&=(this.markers.hideBox(this.activePopoverAnnotationId),null),this.activePopover?.destroy(),this.activePopover=null}persist(){u(this.annotations),this.markers.update(this.annotations),this.fab.updateBadge(this.annotations.length),this.fab.updateActionStates(this.annotations.length)}};customElements.define(`ui-annotator`,le),document.querySelector(`ui-annotator`)||document.body.appendChild(document.createElement(`ui-annotator`))})();